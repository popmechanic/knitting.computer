<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>cinema.computer</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
      :root {
        /* Cinema palette */
        --color-ana-1: oklch(44.9% 0.134 271);
        --color-ana-1-contrast: #fff;
        --color-ana-2: oklch(24.9% 0.096 241);
        --color-ana-2-contrast: #fff;
        --color-ana-3: oklch(34.9% 0.109 251);
        --color-ana-3-contrast: #fff;
        --color-ana-4: oklch(59.9% 0.103 261);
        --color-ana-4-contrast: #000;
        --color-ana-5: oklch(69.9% 0.084 286);
        --color-ana-5-contrast: #000;
        --color-ana-6: oklch(79.9% 0.072 301);
        --color-ana-6-contrast: #000;

        /* Core colors */
        --vibes-black: #0f172a;
        --vibes-white: #ffffff;
        --vibes-near-black: #1a1a1a;
        --vibes-cream: #fffff0;

        /* Gray scale */
        --vibes-gray-lightest: #f1f5f9;
        --vibes-gray-ultralight: #f8fafc;

        /* Menu colors */
        --vibes-menu-bg: var(--color-ana-3);
        --vibes-menu-grid: rgba(255, 255, 255, 0.1);

        /* Button variant colors */
        --vibes-variant-blue: var(--color-ana-4);
        --vibes-variant-red: #DA291C;
        --vibes-variant-yellow: var(--color-ana-5);
        --vibes-variant-gray: var(--color-ana-3);

        /* Button styling */
        --vibes-button-bg: var(--color-ana-3);
        --vibes-button-text: var(--color-ana-6);
        --vibes-button-border: var(--color-ana-4);
        --vibes-button-icon-bg: var(--color-ana-2);
        --vibes-button-icon-fill: var(--color-ana-6);

        /* Landing page theming */
        --landing-accent: var(--color-ana-4);
        --landing-accent-hover: var(--color-ana-5);
        --landing-bg: var(--color-ana-2);
        --landing-surface: var(--color-ana-3);

        /* Admin dashboard theming */
        --admin-bg: var(--color-ana-2);
        --admin-card-bg: var(--color-ana-3);
        --admin-text: var(--color-ana-6);
        --admin-text-muted: var(--color-ana-4);
        --admin-accent: var(--color-ana-5);
        --admin-border: var(--color-ana-4);
        --admin-shadow: var(--color-ana-1);

        /* Glass effects */
        --glass-bg: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
        --glass-blur: 20px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--color-ana-2);
        color: var(--color-ana-6);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      #container {
        width: 100%;
        min-height: 100vh;
      }

      /* Glass panel utility */
      .glass-panel {
        background: var(--glass-bg);
        backdrop-filter: blur(var(--glass-blur));
        -webkit-backdrop-filter: blur(var(--glass-blur));
        border: 1px solid var(--glass-border);
        border-radius: 24px;
      }

      .glass-panel-strong {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 24px;
      }

      /* Subtle grid pattern for depth */
      .cinema-grid {
        background-image:
          linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
          linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
        background-size: 60px 60px;
      }

      /* Glow effects */
      .glow-accent {
        box-shadow:
          0 0 60px -20px var(--color-ana-4),
          0 0 100px -30px var(--color-ana-5);
      }

      /* Noise texture overlay */
      .noise-overlay::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0.015;
        z-index: 1000;
        pointer-events: none;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      }

      /* Smooth gradient mesh background */
      .gradient-mesh {
        background:
          radial-gradient(ellipse 80% 50% at 20% 40%, var(--color-ana-1) 0%, transparent 50%),
          radial-gradient(ellipse 60% 40% at 80% 20%, var(--color-ana-3) 0%, transparent 40%),
          radial-gradient(ellipse 50% 50% at 60% 80%, var(--color-ana-1) 0%, transparent 45%),
          var(--color-ana-2);
      }

      /* Input styling */
      .glass-input {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        color: var(--color-ana-6);
        transition: all 0.3s ease;
      }

      .glass-input:focus {
        outline: none;
        border-color: var(--color-ana-4);
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.05);
      }

      .glass-input::placeholder {
        color: var(--color-ana-4);
        opacity: 0.6;
      }

      /* Button styles */
      .btn-primary {
        background: linear-gradient(135deg, var(--color-ana-4) 0%, var(--color-ana-5) 100%);
        color: var(--color-ana-2);
        border: none;
        border-radius: 16px;
        font-weight: 600;
        letter-spacing: -0.01em;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-primary::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, var(--color-ana-5) 0%, var(--color-ana-6) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .btn-primary:hover::before {
        opacity: 1;
      }

      .btn-primary span {
        position: relative;
        z-index: 1;
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.05);
        color: var(--color-ana-6);
        border: 1px solid rgba(255, 255, 255, 0.15);
        border-radius: 16px;
        font-weight: 600;
        letter-spacing: -0.01em;
        transition: all 0.3s ease;
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.25);
      }

      /* Pricing card hover effect */
      .pricing-card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .pricing-card:hover {
        transform: translateY(-8px);
      }

      /* Feature check icon */
      .feature-check {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5));
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
      }

      /* Animated gradient border */
      @keyframes borderGlow {
        0%, 100% { opacity: 0.5; }
        50% { opacity: 1; }
      }

      .popular-badge {
        background: linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5));
        animation: borderGlow 2s ease-in-out infinite;
      }

      /* Typography */
      .text-display {
        font-weight: 700;
        letter-spacing: -0.03em;
        line-height: 1.1;
      }

      .text-body {
        font-weight: 400;
        letter-spacing: -0.01em;
        line-height: 1.6;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <!-- NOTE: @clerk/clerk-react uses direct URL in import statement because
         Babel standalone doesn't properly resolve import maps for bare specifiers -->
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.3.1",
          "react-dom": "https://esm.sh/react-dom@18.3.1?deps=react@18.3.1",
          "react-dom/client": "https://esm.sh/react-dom@18.3.1/client?deps=react@18.3.1",
          "react/jsx-runtime": "https://esm.sh/react@18.3.1/jsx-runtime",
          "use-fireproof": "https://esm.sh/use-fireproof@0.20.0-dev-preview-50?deps=react@18.3.1",
          "use-vibes": "https://esm.sh/use-vibes@0.18.9?deps=react@18.3.1"
        }
      }
    </script>
    <!-- Load React globally for menu components -->
    <script type="module">
      import * as React from "react";
      window.React = React;

      // === VibesSwitch ===
      const switchColors = { primary: "var(--vibes-black)", secondary: "var(--vibes-white)" };
      function VibesSwitch({ size = 24, className, isActive, onToggle }) {
        const [internalActive, setInternalActive] = React.useState(true);
        const logicalActive = isActive !== undefined ? isActive : internalActive;
        const active = !logicalActive;
        const handlePointerDown = (e) => {
          e.stopPropagation();
          e.preventDefault();
          const newState = !logicalActive;
          if (onToggle) onToggle(newState);
          if (isActive === undefined) setInternalActive(newState);
        };
        const originalD = "M426.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,20.023-0.666,30.021-0.371c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77C446.914,285.721,438.682,285.667,426.866,285.985z";
        const stretchedD = "M165.866,285.985c-7.999-0.416-19.597-0.733-31.141-1.687c-15.692-1.297-28.809-8.481-40.105-19.104c-12.77-12.008-20.478-26.828-22.714-44.177c-3.048-23.644,3.384-44.558,19.646-62.143c9.174-9.92,20.248-17.25,33.444-20.363c7.786-1.837,15.944-2.399,23.973-2.828c9.988-0.535,121.023-0.666,131.021-0.371c10.191,0.301,20.433,0.806,30.521,2.175c12.493,1.696,23.132,7.919,32.552,16.091c14.221,12.337,22.777,27.953,25.184,46.594c2.822,21.859-2.605,41.617-16.777,58.695c-9.494,11.441-21.349,19.648-35.722,23.502c-6.656,1.785-13.724,2.278-20.647,2.77C286.914,285.721,177.682,285.667,165.866,285.985z";
        return React.createElement("svg", { xmlns: "http://www.w3.org/2000/svg", height: size, viewBox: "0 0 600 300", fill: "currentColor", className, onPointerDown: handlePointerDown },
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", fill: "#000", d: "M293.353,298.09c-41.038,0-82.078,0.125-123.115-0.077c-11.993-0.06-24.011-0.701-35.964-1.703c-15.871-1.331-29.73-7.937-41.948-17.946c-16.769-13.736-27.207-31.417-30.983-52.7c-4.424-24.93,1.404-47.685,16.506-67.913c11.502-15.407,26.564-26.1,45.258-30.884c7.615-1.949,15.631-2.91,23.501-3.165c20.08-0.652,40.179-0.853,60.271-0.879c69.503-0.094,139.007-0.106,208.51,0.02c14.765,0.026,29.583,0.097,44.28,1.313c36.984,3.059,61.78,23.095,74.653,57.301c17.011,45.199-8.414,96.835-54.29,111.864c-7.919,2.595-16.165,3.721-24.434,3.871c-25.614,0.467-51.234,0.742-76.853,0.867C350.282,298.197,321.817,298.09,293.353,298.09z" }),
          React.createElement("path", { fill: "#fff", fillRule: "evenodd", clipRule: "evenodd", d: active ? stretchedD : originalD, style: { transition: "d 0.3s ease, transform 0.8s ease", transform: active ? "translateX(3px)" : "none" } }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 0.5s ease", fill: active ? switchColors.primary : switchColors.secondary }, d: "M181.891,205.861c0-5.043-0.001-10.086,0-15.129c0.001-5.046,1.679-7.539,6.606-7.695c9.292-0.294,18.653-1.051,27.888,0.707c7.614,1.449,11.523,5.954,11.902,13.446c0.066,1.312-0.313,2.752-0.857,3.966c-1.401,3.123-1.399,6.266-0.673,9.507c0.301,1.342,0.443,2.723,0.787,4.053c1.274,4.925-1.78,10.114-6.085,11.937c-3.111,1.318-6.561,2.327-9.909,2.497c-7.303,0.37-14.639,0.136-21.96,0.101c-1.165-0.005-2.345-0.181-3.488-0.422c-2.657-0.56-4.162-2.962-4.197-6.801C181.854,216.639,181.891,211.25,181.891,205.861z M204.442,192.385c-2.757,0-5.514,0-8.271,0c-3.695,0-5.151,1.669-4.712,5.403c0.369,3.14,1.05,3.735,4.225,3.737c5.024,0.004,10.05,0.109,15.07-0.014c2.028-0.05,4.167-0.27,6.04-0.98c3.182-1.207,3.639-4.256,1.008-6.455c-1.073-0.896-2.659-1.509-4.06-1.618C210.659,192.22,207.544,192.385,204.442,192.385z M204.334,211.104c0,0.045,0,0.091,0,0.137c-3.101,0-6.203-0.055-9.302,0.037c-0.823,0.024-2.257,0.373-2.344,0.794c-0.447,2.154-0.959,4.444-0.639,6.563c0.276,1.822,2.447,1.451,3.882,1.441c5.989-0.042,11.98-0.118,17.961-0.385c1.416-0.063,2.859-0.79,4.176-1.441c1.79-0.886,1.833-2.475,1.029-4.046c-1.166-2.276-3.297-3.024-5.677-3.081C210.394,211.049,207.363,211.104,204.334,211.104z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 0.8s ease", fill: active ? switchColors.primary : switchColors.secondary }, d: "M291.409,229.748c-3.621-0.394-7.838-0.587-11.94-1.379c-3.577-0.69-6.343-2.991-8.213-6.163c-1.763-2.99-0.301-5.6,3.139-5.292c2.287,0.205,4.512,1.129,6.758,1.755c6.281,1.751,12.643,1.892,19.053,0.951c0.667-0.098,1.31-0.416,1.941-0.686c1.502-0.644,2.55-1.682,2.581-3.415c0.031-1.74-1.195-2.749-2.579-3.132c-2.298-0.637-4.688-1.021-7.065-1.273c-5.062-0.536-10.252-0.401-15.187-1.475c-9.677-2.105-11.678-10.53-10.101-16.009c1.62-5.625,5.911-8.92,11.318-9.73c8.388-1.257,16.925-1.491,25.279,0.654c3.702,0.951,6.615,3.072,7.883,6.931c0.918,2.792-0.332,4.6-3.268,4.357c-1.684-0.139-3.367-0.676-4.974-1.248c-6.711-2.387-13.572-2.897-20.569-1.783c-1.001,0.159-2.146,0.414-2.875,1.034c-0.901,0.766-2.016,1.981-1.98,2.964c0.041,1.128,0.995,2.733,1.991,3.206c1.81,0.857,3.925,1.279,5.948,1.441c5.152,0.41,10.356,0.296,15.479,0.905c7.98,0.949,13.779,9.833,11.241,17.125c-1.959,5.628-6.44,8.489-12.143,9.322C299.455,229.344,295.715,229.419,291.409,229.748z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1.2s ease", fill: active ? switchColors.primary : switchColors.secondary }, d: "M235.786,208.14c0-6.905-0.01-13.809,0.004-20.714c0.007-3.474,0.948-4.428,4.415-3.758c6.62,1.279,13.232,2.651,19.759,4.331c1.7,0.438,3.404,1.896,4.515,3.341c1.777,2.31,0.433,5.367-2.463,5.745c-1.86,0.243-3.819-0.138-5.717-0.368c-2.183-0.264-4.339-0.783-6.525-0.976c-1.572-0.138-3.065,0.375-3.8,1.959c-0.76,1.638-0.319,3.329,0.942,4.34c1.619,1.296,3.522,2.327,5.447,3.128c2.146,0.894,4.539,1.207,6.66,2.145c1.446,0.64,2.982,1.687,3.786,2.981c0.689,1.11,0.928,3.094,0.378,4.202c-0.492,0.991-2.32,1.795-3.579,1.825c-2.238,0.052-4.483-0.652-6.741-0.832c-1.614-0.127-3.333-0.203-4.865,0.212c-2.574,0.699-3.225,3.013-1.719,5.218c1.396,2.044,3.431,3.141,5.757,3.761c2.791,0.744,5.637,1.315,8.373,2.222c3.19,1.058,4.791,3.496,4.801,6.723c0.011,3.365-1.759,5.021-5.138,4.424c-4.402-0.778-8.759-1.81-13.134-2.735c-2.357-0.499-4.718-0.981-7.069-1.511c-3.263-0.737-4.132-1.805-4.141-5.154c-0.019-6.836-0.006-13.672-0.006-20.508C235.747,208.141,235.766,208.14,235.786,208.14z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 0.6s ease", fill: active ? switchColors.primary : switchColors.secondary }, d: "M135.138,229.842c-2.941-0.084-5.296-1.462-6.684-3.9c-1.827-3.21-3.328-6.618-4.81-10.011c-3.55-8.128-7.021-16.291-10.486-24.455c-0.48-1.132-0.902-2.329-1.087-3.536c-0.417-2.72,1.238-4.585,3.938-4.119c1.591,0.275,3.569,0.98,4.45,2.173c2.226,3.015,4.175,6.299,5.784,9.69c2.208,4.654,3.898,9.552,6.032,14.244c0.628,1.379,2.009,2.416,3.045,3.609c0.892-1.159,2.042-2.201,2.63-3.498c2.697-5.953,5.22-11.985,7.841-17.974c1.423-3.252,3.089-6.418,6.532-7.905c1.238-0.535,3.012-0.712,4.184-0.214c0.81,0.344,1.377,2.126,1.385,3.271c0.009,1.458-0.479,2.997-1.059,4.371c-4.227,10.013-8.504,20.005-12.833,29.974c-0.79,1.819-1.762,3.589-2.875,5.229C139.73,228.848,137.671,229.894,135.138,229.842z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1.3s ease", fill: active ? switchColors.primary : switchColors.secondary }, d: "M164.636,206.263c0-6.691,0.054-13.383-0.036-20.073c-0.024-1.851,0.716-2.67,2.449-2.81c0.274-0.022,0.549-0.054,0.823-0.076c5.488-0.445,6.091,0.105,6.091,5.562c0,12.348,0,24.695,0,37.043c0,2.887-0.354,3.405-3.222,3.618c-1.628,0.121-3.338-0.001-4.91-0.408c-0.593-0.153-1.265-1.408-1.278-2.171c-0.096-5.584-0.034-11.172-0.022-16.759c0.002-1.308,0-2.617,0-3.926C164.566,206.263,164.601,206.263,164.636,206.263z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1s ease", fill: active ? switchColors.secondary : switchColors.primary }, d: "M388.313,210.147c0-6.356,0.034-12.713-0.023-19.069c-0.015-1.61,0.359-2.472,2.19-2.346c2.887,0.198,5.809,0.045,8.671,0.398c4.396,0.542,8.019,4.294,8.144,8.904c0.223,8.142,0.265,16.304-0.074,24.439c-0.248,5.945-4.552,9.662-10.491,9.831c-1.999,0.057-4.003-0.081-6.006-0.09c-1.746-0.008-2.439-0.853-2.428-2.584C388.34,223.136,388.313,216.642,388.313,210.147z M393.418,210.324c-0.037,0-0.075,0-0.114,0c0,4.55-0.038,9.101,0.015,13.65c0.031,2.688,0.926,3.439,3.56,3.239c3.273-0.248,5.493-2.511,5.534-6.04c0.082-7.099,0.054-14.2-0.033-21.299c-0.041-3.268-1.739-5.241-4.87-6.092c-2.68-0.728-4.025,0.161-4.07,2.896C393.364,201.226,393.418,205.775,393.418,210.324z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1s ease", fill: active ? switchColors.secondary : switchColors.primary }, d: "M416.875,210.721c0.068-3.305,1.849-5.306,4.727-5.309c2.765-0.003,4.924,2.404,4.816,5.371c-0.106,2.956-2.355,5.212-5.12,5.138C418.626,215.849,416.813,213.718,416.875,210.721z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1s ease", fill: active ? switchColors.secondary : switchColors.primary }, d: "M440.516,210.627c0,6.281,0.007,12.563-0.004,18.844c-0.004,2.067-0.805,3.038-2.531,3.015c-1.877-0.025-2.365-1.136-2.359-2.876c0.046-12.631,0.019-25.263,0.029-37.895c0.002-2.592,0.525-3.205,2.419-3.148c1.856,0.057,2.479,1.03,2.466,2.803C440.484,197.788,440.515,204.208,440.516,210.627z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1s ease", fill: active ? switchColors.secondary : switchColors.primary }, d: "M449.933,210.636c0.102-3.331,1.886-5.279,4.778-5.22c2.67,0.055,4.829,2.432,4.762,5.243c-0.073,3.021-2.404,5.36-5.242,5.261C451.606,215.829,449.84,213.657,449.933,210.636z" }),
          React.createElement("path", { fillRule: "evenodd", clipRule: "evenodd", style: { transition: "fill 1s ease", fill: active ? switchColors.secondary : switchColors.primary }, d: "M478.079,200.8c0.674-1.566,1.121-2.53,1.506-3.519c0.673-1.73,1.252-3.5,1.981-5.205c0.315-0.737,0.766-1.654,1.407-1.961c1.094-0.523,2.388-0.63,3.598-0.912c0.205,1.142,0.798,2.381,0.537,3.404c-0.606,2.388-1.448,4.756-2.507,6.984c-3.981,8.389-4.352,17.254-3.78,26.282c0.091,1.438,0.031,2.899-0.105,4.335c-0.14,1.473-0.989,2.428-2.542,2.497c-1.514,0.067-2.311-0.903-2.54-2.23c-0.232-1.348-0.394-2.754-0.277-4.108c0.94-10.972-1.116-21.38-5.626-31.375c-0.586-1.298-0.899-2.762-1.093-4.183c-0.233-1.712,0.825-2.592,2.379-1.843c1.164,0.561,2.345,1.55,2.973,2.657c1.078,1.897,1.712,4.043,2.568,6.07C476.918,198.547,477.37,199.361,478.079,200.8z" })
        );
      }
      window.VibesSwitch = VibesSwitch;

      // === HiddenMenuWrapper styles ===
      const hiddenMenuTheme = {
        colors: { menuBg: "var(--vibes-menu-bg)", menuText: "var(--vibes-black)", contentBg: "#1e1e1e", shadow: "rgba(0,0,0,0.3)", gridLineColor: "var(--vibes-menu-grid)" },
        zIndex: { menu: 5, content: 10, toggle: 20 },
        dimensions: { gridSize: "40px", padding: "24px", bottomOffset: "16px" },
        animation: { duration: "0.4s", easing: "ease", blurAmount: "4px" }
      };
      const getWrapperStyle = () => ({ position: "relative", overflow: "hidden" });
      const getMenuStyle = () => ({ position: "fixed", bottom: 0, left: 0, right: 0, zIndex: hiddenMenuTheme.zIndex.menu, color: hiddenMenuTheme.colors.menuText, padding: hiddenMenuTheme.dimensions.padding, boxShadow: "0 -2px 10px " + hiddenMenuTheme.colors.shadow, backgroundColor: hiddenMenuTheme.colors.menuBg, backgroundImage: "linear-gradient(" + hiddenMenuTheme.colors.gridLineColor + " 1px, transparent 1px), linear-gradient(90deg, " + hiddenMenuTheme.colors.gridLineColor + " 1px, transparent 1px)", backgroundSize: hiddenMenuTheme.dimensions.gridSize + " " + hiddenMenuTheme.dimensions.gridSize });
      const getContentWrapperStyle = (menuHeight, menuOpen, isBouncing) => ({ position: "fixed", top: 0, left: 0, right: 0, bottom: 0, zIndex: hiddenMenuTheme.zIndex.content, transition: isBouncing ? "filter 0.3s " + hiddenMenuTheme.animation.easing : "transform " + hiddenMenuTheme.animation.duration + " " + hiddenMenuTheme.animation.easing + ", filter 0.3s " + hiddenMenuTheme.animation.easing, transform: menuOpen ? "translateY(-" + menuHeight + "px)" : "translateY(0)", overflowY: "auto", borderTopColor: hiddenMenuTheme.colors.menuBg, borderTopWidth: "1px", borderTopStyle: "solid", boxShadow: "0 -2px 10px " + hiddenMenuTheme.colors.shadow, backgroundColor: hiddenMenuTheme.colors.contentBg, animation: isBouncing ? "vibes-drop-to-close 0.8s cubic-bezier(0.25,0.46,0.45,0.94)" : undefined, willChange: isBouncing ? "transform" : undefined });
      const getInnerContentWrapperStyle = (menuOpen) => ({ filter: menuOpen ? "blur(" + hiddenMenuTheme.animation.blurAmount + ")" : "none", width: "100%", height: "100%" });
      const getToggleButtonStyle = () => ({ position: "fixed", bottom: hiddenMenuTheme.dimensions.bottomOffset, right: 0, zIndex: hiddenMenuTheme.zIndex.toggle, backgroundColor: "transparent", border: "none", cursor: "pointer" });

      // === HiddenMenuWrapper ===
      function HiddenMenuWrapper({ children, menuContent, showVibesSwitch = true }) {
        const [menuOpen, setMenuOpen] = React.useState(false);
        const [menuHeight, setMenuHeight] = React.useState(0);
        const menuRef = React.useRef(null);
        const buttonRef = React.useRef(null);
        const [isBouncing, setIsBouncing] = React.useState(false);
        const [hasBouncedOnMount, setHasBouncedOnMount] = React.useState(false);

        React.useEffect(() => {
          if (!hasBouncedOnMount && !menuOpen) {
            const prefersReducedMotion = window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches || false;
            if (!prefersReducedMotion) {
              setIsBouncing(true);
              setTimeout(() => setIsBouncing(false), 800);
            }
            setHasBouncedOnMount(true);
          }
        }, [hasBouncedOnMount, menuOpen]);

        React.useEffect(() => {
          const styleId = "vibes-drop-to-close-keyframes";
          if (!document.getElementById(styleId)) {
            const style = document.createElement("style");
            style.id = styleId;
            style.textContent = "@keyframes vibes-drop-to-close { 0% { transform: translateY(-400px); } 10% { transform: translateY(0); } 25% { transform: translateY(-175px); } 35% { transform: translateY(0); } 48% { transform: translateY(-75px); } 62% { transform: translateY(0); } 72% { transform: translateY(-25px); } 80% { transform: translateY(0); } 82% { transform: translateY(-10px); } 88% { transform: translateY(0); } 91% { transform: translateY(-5px); } 95% { transform: translateY(0); } 100% { transform: translateY(0); } }";
            document.head.appendChild(style);
          }
        }, []);

        React.useEffect(() => {
          if (menuRef.current) setMenuHeight(menuRef.current.offsetHeight);
        }, [menuContent]);

        React.useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === "Escape" && menuOpen) {
              setMenuOpen(false);
              buttonRef.current?.focus();
            }
          };
          document.addEventListener("keydown", handleKeyDown);
          return () => document.removeEventListener("keydown", handleKeyDown);
        }, [menuOpen]);

        return React.createElement("div", { style: getWrapperStyle() },
          React.createElement("div", { ref: menuRef, style: getMenuStyle() }, menuContent),
          React.createElement("div", { style: getContentWrapperStyle(menuHeight, menuOpen, isBouncing) },
            React.createElement("div", { style: getInnerContentWrapperStyle(menuOpen) },
              React.createElement("div", { style: { width: "100%", height: "100%" } }, children)
            )
          ),
          showVibesSwitch && React.createElement("button", { ref: buttonRef, onClick: () => setMenuOpen(!menuOpen), style: getToggleButtonStyle() },
            React.createElement(VibesSwitch, { size: 80 })
          )
        );
      }
      window.HiddenMenuWrapper = HiddenMenuWrapper;

      // === VibesButton ===
      const variantColors = { blue: "var(--vibes-variant-blue)", red: "var(--vibes-variant-red)", yellow: "var(--vibes-variant-yellow)", gray: "var(--vibes-variant-gray)" };
      function VibesButton({ variant = "blue", children, onClick, href, style: customStyle }) {
        const [isHovered, setHovered] = React.useState(false);
        const [isActive, setActive] = React.useState(false);
        const cssColor = variantColors[variant] || variant;
        let transform = "translate(0px, 0px)";
        let boxShadow = "8px 10px 0px 0px " + cssColor + ", 8px 10px 0px 2px var(--vibes-button-border)";
        if (isHovered && !isActive) { transform = "translate(2px, 2px)"; boxShadow = "2px 3px 0px 0px " + cssColor + ", 2px 3px 0px 2px var(--vibes-button-border)"; }
        if (isActive) { transform = "translate(4px, 5px)"; boxShadow = "none"; }
        const baseStyle = { width: "100%", minHeight: "60px", padding: "0.75rem 1.5rem", borderRadius: "12px", fontSize: "1rem", fontWeight: 700, textTransform: "uppercase", letterSpacing: "0.05em", cursor: "pointer", transition: "all 0.15s ease", transform, boxShadow, background: "var(--vibes-button-bg)", color: "var(--vibes-button-text)", border: "2px solid var(--vibes-button-border)", textDecoration: "none", display: "flex", alignItems: "center", justifyContent: "center", ...customStyle };
        const props = { style: baseStyle, onMouseEnter: () => setHovered(true), onMouseLeave: () => { setHovered(false); setActive(false); }, onMouseDown: () => setActive(true), onMouseUp: () => setActive(false) };
        if (href) return React.createElement("a", { ...props, href, target: "_blank", rel: "noopener noreferrer" }, children);
        return React.createElement("button", { ...props, onClick }, children);
      }
      window.VibesButton = VibesButton;

      // === VibesPanel ===
      function VibesPanel() {
        return React.createElement("div", { style: { display: "flex", flexDirection: "column", gap: "12px", alignItems: "center", maxWidth: "400px", margin: "0 auto" } },
          React.createElement(VibesButton, { variant: "blue", href: "https://vibes.diy" }, "VISIT VIBES.DIY"),
          React.createElement(VibesButton, { variant: "yellow", href: "https://vibes.diy" }, "CREATE YOUR OWN")
        );
      }
      window.VibesPanel = VibesPanel;
    </script>
    <script type="text/babel" data-type="module">
      import React, { createContext, useContext, useState, useEffect, useRef, useCallback, useMemo, useReducer } from "react";
      import ReactDOMClient from "react-dom/client";
      import { useFireproof } from "use-fireproof";
      // NOTE: Using direct URL because Babel standalone doesn't properly use import maps for bare specifiers
      import {
        ClerkProvider,
        SignedIn,
        SignedOut,
        SignInButton,
        SignUpButton,
        UserButton,
        useUser,
        useAuth
      } from "https://esm.sh/@clerk/clerk-react@5?deps=react@18.3.1,react-dom@18.3.1";

      // === Menu Components from window (defined in module script above) ===
      const HiddenMenuWrapper = window.HiddenMenuWrapper;
      const VibesPanel = window.VibesPanel;
      const VibesSwitch = window.VibesSwitch;
      const VibesButton = window.VibesButton;

      // === Configuration (like mixtape pattern) ===
      const CONFIG = {
        clerkPublishableKey: "pk_test_bWlnaHR5LXN0YXJmaXNoLTM0LmNsZXJrLmFjY291bnRzLmRldiQ",
        appName: "cinema-computer",
        appTitle: "cinema.computer",
        domain: "cinema.computer",
        pricing: {
          monthly: "$5",
          yearly: "$49"
        },
        features: ["Your own subdomain", "Unlimited video hosting", "Share with anyone", "Dark cinema experience", "No ads ever"],
        tagline: "Your personal screening room",
        adminUserIds: ["user_37SeOghWZsRBbMUJXtSK9cxKETH"]
      };

      // Legacy aliases for backward compatibility
      const CLERK_PUBLISHABLE_KEY = CONFIG.clerkPublishableKey;
      const APP_NAME = CONFIG.appName;
      const APP_DOMAIN = CONFIG.domain;
      const MONTHLY_PRICE = CONFIG.pricing.monthly;
      const YEARLY_PRICE = CONFIG.pricing.yearly;
      const FEATURES = CONFIG.features;
      const APP_TAGLINE = CONFIG.tagline;
      const ADMIN_USER_IDS = CONFIG.adminUserIds;

      // === Route Detection ===
      function getRouteInfo() {
        const hostname = window.location.hostname;
        const parts = hostname.split('.');
        const params = new URLSearchParams(window.location.search);
        const testSubdomain = params.get('subdomain');

        // Handle localhost for testing
        if (hostname === 'localhost' || hostname === '127.0.0.1') {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Handle pages.dev for testing (before custom domain is set up)
        if (hostname.endsWith('.pages.dev')) {
          if (testSubdomain === 'admin') return { route: 'admin', subdomain: null };
          if (testSubdomain) return { route: 'tenant', subdomain: testSubdomain };
          return { route: 'landing', subdomain: null };
        }

        // Production: detect subdomain from hostname
        if (parts.length <= 2 || parts[0] === 'www') {
          return { route: 'landing', subdomain: null };
        }
        if (parts[0] === 'admin') {
          return { route: 'admin', subdomain: null };
        }
        return { route: 'tenant', subdomain: parts[0] };
      }

      const routeInfo = getRouteInfo();

      // === Tenant Context ===
      const TenantContext = createContext(null);

      function useTenant() {
        const context = useContext(TenantContext);
        if (!context) throw new Error("useTenant must be used within TenantProvider");
        return context;
      }

      // Make useTenant available globally for the embedded App
      window.useTenant = useTenant;

      function TenantProvider({ children, subdomain }) {
        const dbName = `${APP_NAME}-${subdomain}`;
        return (
          <TenantContext.Provider value={{ subdomain, dbName, appName: APP_NAME, domain: APP_DOMAIN }}>
            {children}
          </TenantContext.Provider>
        );
      }

      // === Subscription Gate ===
      function SubscriptionRequired() {
        return (
          <div className="min-h-screen flex items-center justify-center gradient-mesh cinema-grid p-4">
            <div className="max-w-md text-center p-8 glass-panel-strong">
              <h2 className="text-display text-2xl mb-4" style={{ color: 'var(--color-ana-6)' }}>Subscription Required</h2>
              <p className="mb-6" style={{ color: 'var(--color-ana-4)' }}>Please subscribe to access this screening room.</p>
              <a
                href={`https://${APP_DOMAIN}`}
                className="btn-primary inline-block px-6 py-3 cursor-pointer"
              >
                <span>View Plans</span>
              </a>
            </div>
          </div>
        );
      }

      function SubscriptionGate({ children }) {
        const { has, isLoaded, userId } = useAuth();
        const { user } = useUser();

        if (!isLoaded) {
          return (
            <div className="min-h-screen flex items-center justify-center gradient-mesh cinema-grid">
              <div className="animate-pulse text-lg font-semibold" style={{ color: 'var(--color-ana-5)' }}>Loading...</div>
            </div>
          );
        }

        // Allow admin users to bypass subscription check
        const isAdmin = ADMIN_USER_IDS.includes(userId);
        const hasClerkSubscription = has({ plan: 'free' }) || has({ plan: 'pro' }) || has({ plan: 'basic' }) || has({ plan: 'monthly' }) || has({ plan: 'yearly' }) || has({ plan: 'starter' });
        const hasMetadataPlan = user?.unsafeMetadata?.plan && ['free', 'pro', 'basic', 'monthly', 'yearly', 'starter'].includes(user.unsafeMetadata.plan);
        const hasSubscription = isAdmin || hasClerkSubscription || hasMetadataPlan;

        if (!hasSubscription) {
          return <SubscriptionRequired />;
        }

        return children;
      }

      // === Tenant Registration (tracks subdomain visits in Worker KV) ===
      function TenantRegistration({ subdomain, children }) {
        const { user, isLoaded } = useUser();
        const [registered, setRegistered] = useState(false);
        const [isRegistering, setIsRegistering] = useState(false);

        useEffect(() => {
          if (!isLoaded || !user || registered) return;

          // Skip registration if user already has a plan
          if (user.unsafeMetadata?.plan) {
            console.log(`[TenantRegistration] User already has plan: ${user.unsafeMetadata.plan}`);
            setRegistered(true);
            return;
          }

          const register = async () => {
            try {
              setIsRegistering(true);
              console.log(`[TenantRegistration] Registering ${subdomain} for user ${user.id}`);

              // Update user metadata first
              await user.update({
                unsafeMetadata: {
                  ...user.unsafeMetadata,
                  plan: 'free',
                  subdomain,
                  registeredAt: new Date().toISOString()
                }
              });

              const response = await fetch(`https://${APP_DOMAIN}/api/tenants/register`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'include',
                body: JSON.stringify({
                  subdomain,
                  userId: user.id,
                  email: user.primaryEmailAddress?.emailAddress,
                  plan: 'free'
                })
              });
              const data = await response.json();
              if (response.ok) {
                console.log(`[TenantRegistration] Success:`, data);
              } else {
                console.warn(`[TenantRegistration] API returned ${response.status}:`, data);
              }
              setRegistered(true);
            } catch (err) {
              console.error('[TenantRegistration] Failed to register tenant:', err);
              setRegistered(true); // Don't block app on registration failure
            } finally {
              setIsRegistering(false);
            }
          };

          register();
        }, [isLoaded, user, subdomain, registered]);

        if (isRegistering) {
          return (
            <div className="min-h-screen flex items-center justify-center gradient-mesh cinema-grid">
              <div className="animate-pulse text-lg font-semibold" style={{ color: 'var(--color-ana-5)' }}>Setting up your studio...</div>
            </div>
          );
        }

        return children;
      }

      // === Original App Code (embedded during assembly) ===
      // 

// The template provides: useTenant(), CONFIG, ClerkProvider, routing
// This component is the core tenant app that gets wrapped by the template

function App() {
  const { dbName } = useTenant();
  const { database, useLiveQuery } = useFireproof(dbName);
  const [isDragging, setIsDragging] = useState(false);
  const [videoUrl, setVideoUrl] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [showControls, setShowControls] = useState(true);
  const videoRef = useRef(null);
  const controlsTimeout = useRef(null);

  const { docs: videos } = useLiveQuery("type", { key: "video", limit: 1 });
  const currentVideo = videos[0];

  useEffect(() => {
    if (currentVideo?._files?.video) {
      currentVideo._files.video.file().then(file => {
        const url = URL.createObjectURL(file);
        setVideoUrl(url);
      });
    }
  }, [currentVideo?._id]);

  const handleDrag = useCallback((e) => {
    e.preventDefault();
    e.stopPropagation();
  }, []);

  const handleDragIn = useCallback((e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(true);
  }, []);

  const handleDragOut = useCallback((e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
  }, []);

  const handleDrop = useCallback(async (e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);

    const files = e.dataTransfer.files;
    if (files && files[0] && files[0].type.startsWith("video/")) {
      setIsLoading(true);
      const file = files[0];

      if (currentVideo) {
        await database.del(currentVideo._id);
      }

      const doc = {
        type: "video",
        name: file.name,
        uploadedAt: Date.now(),
        _files: { video: file }
      };

      await database.put(doc);
      setIsLoading(false);
    }
  }, [database, currentVideo]);

  const handleMouseMove = () => {
    setShowControls(true);
    if (controlsTimeout.current) clearTimeout(controlsTimeout.current);
    controlsTimeout.current = setTimeout(() => setShowControls(false), 2500);
  };

  const clearVideo = async () => {
    if (currentVideo) {
      await database.del(currentVideo._id);
      setVideoUrl(null);
    }
  };

  return (
    <div className="w-full max-w-5xl mx-auto">
      {isLoading ? (
        <div className="flex flex-col items-center justify-center py-32">
          <div className="w-12 h-12 border-2 rounded-full animate-spin" style={{ borderColor: 'var(--color-ana-4)', borderTopColor: 'transparent' }} />
          <p className="mt-6 text-sm" style={{ color: 'var(--color-ana-4)' }}>Loading film...</p>
        </div>
      ) : videoUrl ? (
        <div className="relative group" onMouseMove={handleMouseMove} onMouseLeave={() => setShowControls(false)}>
          {/* Glow effect */}
          <div className="absolute -inset-4 rounded-3xl opacity-20 blur-3xl transition-opacity duration-700 group-hover:opacity-30" style={{ background: 'var(--color-ana-4)' }} />

          {/* Video container with glass effect */}
          <div className="relative glass-panel-strong overflow-hidden" style={{ borderRadius: '20px' }}>
            <video
              ref={videoRef}
              src={videoUrl}
              controls={showControls}
              className="w-full aspect-video object-contain transition-opacity duration-300"
              style={{ opacity: showControls ? 1 : 0.95, background: 'var(--color-ana-2)' }}
            />
          </div>

          {/* Title overlay */}
          <div className={`absolute bottom-0 left-0 right-0 p-6 transition-opacity duration-500 ${showControls ? 'opacity-100' : 'opacity-0'}`} style={{ background: 'linear-gradient(to top, var(--color-ana-2), transparent)', borderRadius: '0 0 20px 20px' }}>
            <p className="font-medium truncate" style={{ color: 'var(--color-ana-6)' }}>
              {currentVideo?.name?.replace(/\.[^/.]+$/, "")}
            </p>
          </div>

          {/* Clear button */}
          <button
            onClick={clearVideo}
            className="absolute top-4 right-4 text-sm transition-colors duration-300 cursor-pointer px-3 py-1.5 rounded-lg"
            style={{ color: 'var(--color-ana-4)', background: 'rgba(0,0,0,0.3)' }}
          >
            clear screen
          </button>
        </div>
      ) : (
        <div
          onDragEnter={handleDragIn}
          onDragLeave={handleDragOut}
          onDragOver={handleDrag}
          onDrop={handleDrop}
          className={`relative aspect-video glass-panel-strong transition-all duration-500 cursor-pointer flex flex-col items-center justify-center gap-6 ${isDragging ? 'scale-[1.02]' : ''}`}
          style={{
            borderStyle: 'dashed',
            borderWidth: '2px',
            borderColor: isDragging ? 'var(--color-ana-5)' : 'rgba(255,255,255,0.15)',
            background: isDragging ? 'rgba(255,255,255,0.08)' : 'rgba(255,255,255,0.03)'
          }}
        >
          {/* Film strip decoration - left */}
          <div className="absolute left-0 top-0 bottom-0 w-8 flex flex-col justify-around py-4 opacity-30">
            {[...Array(12)].map((_, i) => <div key={i} className="w-4 h-2 rounded-sm ml-2" style={{ background: 'var(--color-ana-3)' }} />)}
          </div>

          {/* Film strip decoration - right */}
          <div className="absolute right-0 top-0 bottom-0 w-8 flex flex-col justify-around py-4 opacity-30">
            {[...Array(12)].map((_, i) => <div key={i} className="w-4 h-2 rounded-sm mr-2 ml-auto" style={{ background: 'var(--color-ana-3)' }} />)}
          </div>

          {/* Projector icon */}
          <div className={`transition-transform duration-500 ${isDragging ? 'scale-110' : ''}`}>
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" style={{ color: isDragging ? 'var(--color-ana-5)' : 'var(--color-ana-4)' }} className="transition-colors duration-300">
              <circle cx="12" cy="12" r="3" stroke="currentColor" strokeWidth="1.5"/>
              <path d="M12 5V3M12 21v-2M5 12H3M21 12h-2M7.05 7.05L5.636 5.636M18.364 18.364l-1.414-1.414M7.05 16.95l-1.414 1.414M18.364 5.636l-1.414 1.414" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round"/>
            </svg>
          </div>

          <div className="text-center px-8">
            <p className="text-lg font-medium transition-colors duration-300" style={{ color: isDragging ? 'var(--color-ana-5)' : 'var(--color-ana-4)' }}>
              {isDragging ? 'Release to screen' : 'Drop a video file'}
            </p>
            <p className="text-sm mt-2" style={{ color: 'var(--color-ana-3)' }}>mp4, webm, mov</p>
          </div>
        </div>
      )}
    </div>
  );
}

      // === Sign In Screen (for tenant) ===
      function SignInScreen({ subdomain }) {
        return (
          <div className="min-h-screen flex items-center justify-center gradient-mesh cinema-grid p-4">
            {/* Decorative glows */}
            <div className="fixed top-20 left-20 w-96 h-96 rounded-full opacity-30 blur-3xl pointer-events-none" style={{ background: 'var(--color-ana-1)' }} />
            <div className="fixed bottom-20 right-20 w-80 h-80 rounded-full opacity-20 blur-3xl pointer-events-none" style={{ background: 'var(--color-ana-4)' }} />

            <div className="relative max-w-md text-center p-10 glass-panel-strong glow-accent">
              {/* Film reel icon */}
              <div className="w-16 h-16 mx-auto mb-6 rounded-2xl flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5))' }}>
                <svg className="w-8 h-8" fill="none" stroke="var(--color-ana-2)" strokeWidth="2" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3" />
                  <circle cx="12" cy="12" r="9" />
                  <circle cx="12" cy="5" r="1" fill="var(--color-ana-2)" />
                  <circle cx="12" cy="19" r="1" fill="var(--color-ana-2)" />
                  <circle cx="5" cy="12" r="1" fill="var(--color-ana-2)" />
                  <circle cx="19" cy="12" r="1" fill="var(--color-ana-2)" />
                </svg>
              </div>

              <h2 className="text-display text-3xl mb-2" style={{ color: 'var(--color-ana-6)' }}>{subdomain}</h2>
              <p className="mb-8" style={{ color: 'var(--color-ana-4)' }}>Sign in to enter your screening room.</p>
              <div className="flex gap-4 justify-center">
                <SignInButton mode="modal">
                  <button className="btn-primary px-8 py-3 cursor-pointer">
                    <span>Sign In</span>
                  </button>
                </SignInButton>
                <SignUpButton mode="modal">
                  <button className="btn-secondary px-8 py-3 cursor-pointer">
                    Sign Up
                  </button>
                </SignUpButton>
              </div>
            </div>
          </div>
        );
      }

      // === Tenant App Wrapper ===
      function TenantApp({ subdomain }) {
        return (
          <ClerkProvider publishableKey={CLERK_PUBLISHABLE_KEY} afterSignOutUrl={`https://${APP_DOMAIN}`}>
            <TenantProvider subdomain={subdomain}>
              <SignedIn>
                <TenantRegistration subdomain={subdomain}>
                  <SubscriptionGate>
                    <HiddenMenuWrapper menuContent={<VibesPanel />}>
                      <div className="min-h-screen gradient-mesh cinema-grid relative">
                        {/* Decorative glows */}
                        <div className="fixed top-10 left-10 w-72 h-72 rounded-full opacity-20 blur-3xl pointer-events-none" style={{ background: 'var(--color-ana-1)' }} />
                        <div className="fixed bottom-20 right-10 w-96 h-96 rounded-full opacity-15 blur-3xl pointer-events-none" style={{ background: 'var(--color-ana-4)' }} />

                        {/* Header */}
                        <header className="relative z-10 flex justify-between items-center px-6 py-5 max-w-5xl mx-auto">
                          <div className="flex items-center gap-3">
                            <div className="w-9 h-9 rounded-lg flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5))' }}>
                              <svg className="w-4 h-4" fill="none" stroke="var(--color-ana-2)" strokeWidth="2" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="3" />
                                <circle cx="12" cy="12" r="8" />
                              </svg>
                            </div>
                            <span className="font-semibold" style={{ color: 'var(--color-ana-6)' }}>{subdomain}.cinema.computer</span>
                          </div>
                          <UserButton />
                        </header>

                        {/* Main content */}
                        <main className="relative z-10 px-6 py-8">
                          <App />
                        </main>
                      </div>
                    </HiddenMenuWrapper>
                  </SubscriptionGate>
                </TenantRegistration>
              </SignedIn>
              <SignedOut>
                <SignInScreen subdomain={subdomain} />
              </SignedOut>
            </TenantProvider>
          </ClerkProvider>
        );
      }

      // === Admin Components (injected by assemble-sell.js) ===
      // Admin Dashboard Components
// Injected into unified.html by assemble-sell.js
// Uses CONFIG object and CSS variables for theming

// === Subscription Badge Component ===
function SubscriptionBadge({ status }) {
  const badges = {
    active: { bg: 'bg-green-500/20', text: 'text-green-600', label: 'Subscribed' },
    trial: { bg: 'bg-yellow-500/20', text: 'text-yellow-600', label: 'Trial' },
    past_due: { bg: 'bg-red-500/20', text: 'text-red-600', label: 'Past Due' },
    canceled: { bg: 'bg-gray-500/20', text: 'text-gray-600', label: 'Canceled' },
  };
  const badge = badges[status] || { bg: 'bg-blue-500/20', text: 'text-blue-600', label: 'Free' };

  return (
    <span className={`px-2 py-1 rounded text-xs font-bold ${badge.bg} ${badge.text}`}>
      {badge.label}
    </span>
  );
}

// === Admin Dashboard ===
function AdminDashboard() {
  const [tenants, setTenants] = useState([]);
  const [stats, setStats] = useState({
    tenantCount: 0,
    userCount: 0,
    subscriberCount: 0,
    mrr: 0
  });
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [activeTab, setActiveTab] = useState('overview');
  const { user } = useUser();

  // SECURITY: Do NOT add fallbacks like "|| CONFIG.adminUserIds.length === 0"
  // Empty admin list means NO admin access, not everyone is admin
  const isAdmin = CONFIG.adminUserIds.includes(user?.id);

  // Fetch tenants and stats from worker API
  useEffect(() => {
    if (!isAdmin) return;

    async function fetchData() {
      try {
        // Fetch tenants and stats in parallel
        const [tenantsRes, statsRes] = await Promise.all([
          fetch(`https://${CONFIG.domain}/api/tenants`),
          fetch(`https://${CONFIG.domain}/api/stats`)
        ]);

        if (!tenantsRes.ok) throw new Error('Failed to fetch tenants');
        const tenantsData = await tenantsRes.json();
        setTenants(tenantsData.tenants || []);

        if (statsRes.ok) {
          const statsData = await statsRes.json();
          setStats(prev => ({ ...prev, ...statsData }));
        }
      } catch (err) {
        console.error('Error fetching data:', err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    fetchData();
    // Refresh every 30 seconds
    const interval = setInterval(fetchData, 30000);
    return () => clearInterval(interval);
  }, [isAdmin]);

  if (!isAdmin) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-[var(--admin-bg)] p-4">
        <div className="max-w-md text-center p-8 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
          <h2 className="text-2xl font-bold mb-4 text-[var(--admin-text)]">Access Denied</h2>
          <p className="text-[var(--admin-text-muted)] mb-4">You don't have admin permissions.</p>
          <p className="text-sm text-[var(--admin-text-muted)]">Your user ID: {user?.id}</p>
        </div>
      </div>
    );
  }

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-[var(--admin-bg)]">
        <div className="animate-pulse text-lg font-bold text-[var(--admin-text)]">Loading dashboard...</div>
      </div>
    );
  }

  // Filter tenants by subscription status
  const subscribedTenants = tenants.filter(t => t.subscriptionStatus === 'active');
  const trialTenants = tenants.filter(t => !t.subscriptionStatus || t.subscriptionStatus === 'trial');
  const activeTenants = tenants.filter(t => t.status === 'active').length;

  // Calculate MRR from tenants if not from stats
  const monthlyPriceNum = parseInt(String(CONFIG.pricing.monthly).replace(/\D/g, '') || '9');
  const calculatedMRR = stats.mrr || (subscribedTenants.length * monthlyPriceNum);

  return (
    <div className="min-h-screen bg-[var(--admin-bg)] p-4">
      <div className="max-w-6xl mx-auto">
        <header className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-[var(--admin-text)]">{CONFIG.appTitle} Admin</h1>
          <UserButton />
        </header>

        {error && (
          <div className="mb-6 p-4 bg-red-100 border-4 border-red-500 text-red-700">
            Error: {error}
          </div>
        )}

        {/* Tab Navigation */}
        <div className="flex gap-2 mb-6">
          {['overview', 'tenants', 'billing'].map((tab) => (
            <button
              key={tab}
              onClick={() => setActiveTab(tab)}
              className={`px-4 py-2 font-bold border-4 border-[var(--admin-border)] transition-all capitalize ${
                activeTab === tab
                  ? 'bg-[var(--admin-border)] text-[var(--admin-card-bg)] shadow-none'
                  : 'bg-[var(--admin-card-bg)] text-[var(--admin-text)] shadow-[4px_4px_0px_var(--admin-shadow)] hover:shadow-[2px_2px_0px_var(--admin-shadow)] hover:translate-x-[2px] hover:translate-y-[2px]'
              }`}
            >
              {tab}
            </button>
          ))}
        </div>

        {/* Overview Tab */}
        {activeTab === 'overview' && (
          <>
            <div className="grid md:grid-cols-4 gap-6 mb-8">
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">TOTAL TENANTS</h3>
                <p className="text-4xl font-bold text-[var(--admin-text)]">{tenants.length}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_#3b82f6]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">TOTAL USERS</h3>
                <p className="text-4xl font-bold text-blue-600">{stats.userCount}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-accent)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">SUBSCRIBERS</h3>
                <p className="text-4xl font-bold text-green-600">{stats.subscriberCount || subscribedTenants.length}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_#f59e0b]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">MONTHLY REVENUE</h3>
                <p className="text-4xl font-bold text-amber-600">${calculatedMRR}</p>
              </div>
            </div>

            {/* Quick Stats */}
            <div className="grid md:grid-cols-2 gap-6">
              <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
                <h3 className="font-bold mb-4 text-[var(--admin-text)]">Recent Activity</h3>
                <div className="space-y-3 text-sm text-[var(--admin-text-muted)]">
                  <p> {activeTenants} active tenants</p>
                  <p> {tenants.length - activeTenants} pending setup</p>
                  <p> {trialTenants.length} on trial/free</p>
                </div>
              </div>
              <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6">
                <h3 className="font-bold mb-4 text-[var(--admin-text)]">Subscription Breakdown</h3>
                <div className="space-y-3 text-sm text-[var(--admin-text-muted)]">
                  <p> {subscribedTenants.length} paid subscribers</p>
                  <p> {tenants.filter(t => t.subscriptionStatus === 'past_due').length} past due</p>
                  <p> {tenants.filter(t => t.subscriptionStatus === 'canceled').length} canceled</p>
                </div>
              </div>
            </div>
          </>
        )}

        {/* Tenants Tab */}
        {activeTab === 'tenants' && (
          <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
            <div className="p-4 border-b-4 border-[var(--admin-border)] bg-[var(--admin-bg)]">
              <h2 className="text-xl font-bold text-[var(--admin-text)]">All Tenants ({tenants.length})</h2>
            </div>
            <div className="divide-y-2 divide-gray-200">
              {tenants.length === 0 ? (
                <div className="p-8 text-center text-[var(--admin-text-muted)]">No tenants yet</div>
              ) : (
                tenants.map(tenant => (
                  <div key={tenant.subdomain || tenant.id} className="p-4 flex justify-between items-center hover:bg-gray-50">
                    <div className="flex items-center gap-3">
                      {tenant.imageUrl && (
                        <img src={tenant.imageUrl} alt="" className="w-10 h-10 rounded-full border-2 border-[var(--admin-border)]" />
                      )}
                      <div>
                        <p className="font-bold text-[var(--admin-text)]">{tenant.subdomain}.{CONFIG.domain}</p>
                        <p className="text-sm text-[var(--admin-text-muted)]">{tenant.email}</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-4">
                      <SubscriptionBadge status={tenant.subscriptionStatus} />
                      <span className={`px-3 py-1 text-sm font-bold ${
                        tenant.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'
                      }`}>
                        {tenant.status}
                      </span>
                      <span className="text-sm text-[var(--admin-text-muted)]">{tenant.plan}</span>
                    </div>
                  </div>
                ))
              )}
            </div>
          </div>
        )}

        {/* Billing Tab */}
        {activeTab === 'billing' && (
          <>
            <div className="grid md:grid-cols-3 gap-6 mb-8">
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-accent)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">ACTIVE SUBSCRIPTIONS</h3>
                <p className="text-4xl font-bold text-green-600">{subscribedTenants.length}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_#f59e0b]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">TRIAL/FREE</h3>
                <p className="text-4xl font-bold text-amber-600">{trialTenants.length}</p>
              </div>
              <div className="p-6 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)]">
                <h3 className="text-sm font-bold text-[var(--admin-text-muted)] mb-2">MRR</h3>
                <p className="text-4xl font-bold text-[var(--admin-text)]">${calculatedMRR}</p>
              </div>
            </div>

            {/* Plan Configuration */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[6px_6px_0px_var(--admin-shadow)] p-6 mb-6">
              <h3 className="font-bold mb-4 text-[var(--admin-text)]">Plan Configuration</h3>
              <div className="grid md:grid-cols-2 gap-4">
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="font-bold text-[var(--admin-text)]">Monthly Plan</p>
                  <p className="text-2xl font-bold text-[var(--admin-text)]">{CONFIG.pricing.monthly}<span className="text-sm font-normal text-[var(--admin-text-muted)]">/month</span></p>
                </div>
                <div className="p-4 bg-[var(--admin-bg)] border-2 border-[var(--admin-border)]">
                  <p className="font-bold text-[var(--admin-text)]">Yearly Plan</p>
                  <p className="text-2xl font-bold text-[var(--admin-text)]">{CONFIG.pricing.yearly}<span className="text-sm font-normal text-[var(--admin-text-muted)]">/year</span></p>
                </div>
              </div>
            </div>

            {/* Subscribers List */}
            <div className="bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
              <div className="p-4 border-b-4 border-[var(--admin-border)] bg-[var(--admin-bg)]">
                <h2 className="text-xl font-bold text-[var(--admin-text)]">Subscribers ({subscribedTenants.length})</h2>
              </div>
              <div className="divide-y-2 divide-gray-200">
                {subscribedTenants.length === 0 ? (
                  <div className="p-8 text-center text-[var(--admin-text-muted)]">
                    <p className="mb-4">No subscribers yet</p>
                    <p className="text-sm">
                      Set up <a href="https://clerk.com/docs/billing" target="_blank" rel="noopener noreferrer" className="text-blue-600 underline">Clerk Billing</a> to start accepting payments.
                    </p>
                  </div>
                ) : (
                  subscribedTenants.map(tenant => (
                    <div key={tenant.subdomain || tenant.id} className="p-4 flex justify-between items-center hover:bg-gray-50">
                      <div>
                        <p className="font-bold text-[var(--admin-text)]">{tenant.subdomain}.{CONFIG.domain}</p>
                        <p className="text-sm text-[var(--admin-text-muted)]">{tenant.email}</p>
                      </div>
                      <div className="flex items-center gap-4">
                        <span className="text-sm font-medium text-[var(--admin-text-muted)]">
                          {tenant.billingPeriod === 'yearly' ? 'Yearly' : 'Monthly'}
                        </span>
                        <SubscriptionBadge status={tenant.subscriptionStatus} />
                      </div>
                    </div>
                  ))
                )}
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );
}

// === Admin App Wrapper ===
function AdminApp() {
  return (
    <ClerkProvider publishableKey={CONFIG.clerkPublishableKey} afterSignOutUrl={`https://${CONFIG.domain}`}>
      <SignedIn>
        <AdminDashboard />
      </SignedIn>
      <SignedOut>
        <div className="min-h-screen flex items-center justify-center bg-[var(--admin-bg)] p-4">
          <div className="max-w-md text-center p-8 bg-[var(--admin-card-bg)] border-4 border-[var(--admin-border)] shadow-[8px_8px_0px_var(--admin-shadow)]">
            <h2 className="text-2xl font-bold mb-4 text-[var(--admin-text)]">Admin Login</h2>
            <p className="mb-6 text-[var(--admin-text-muted)]">Sign in to access the admin dashboard.</p>
            <SignInButton mode="modal">
              <button className="px-6 py-3 bg-[var(--admin-border)] text-[var(--admin-card-bg)] font-bold border-4 border-[var(--admin-border)] hover:opacity-90 transition-opacity">
                Sign In
              </button>
            </SignInButton>
          </div>
        </div>
      </SignedOut>
    </ClerkProvider>
  );
}

      // === Landing Page Components ===
      function SubdomainPicker({ onSelect }) {
        const [subdomain, setSubdomain] = useState('');
        const [checking, setChecking] = useState(false);
        const [available, setAvailable] = useState(null);
        const [allTenants, setAllTenants] = useState([]);

        useEffect(() => {
          async function fetchTenants() {
            try {
              const response = await fetch(`https://${APP_DOMAIN}/api/tenants`);
              if (response.ok) {
                const data = await response.json();
                setAllTenants(data.tenants || []);
              }
            } catch (err) {
              console.error('Error fetching tenants:', err);
            }
          }
          fetchTenants();
        }, []);

        useEffect(() => {
          if (subdomain.length >= 3) {
            setChecking(true);
            const timer = setTimeout(() => {
              const taken = allTenants.some(t => t.subdomain === subdomain);
              const reserved = ['admin', 'www', 'api', 'app', 'mail', 'smtp', 'ftp'];
              setAvailable(!taken && !reserved.includes(subdomain));
              setChecking(false);
            }, 300);
            return () => clearTimeout(timer);
          } else {
            setAvailable(null);
          }
        }, [subdomain, allTenants]);

        const isValid = /^[a-z0-9-]+$/.test(subdomain) && subdomain.length >= 3 && !subdomain.startsWith('-') && !subdomain.endsWith('-');

        return (
          <div className="space-y-4">
            <label className="block font-semibold text-lg" style={{ color: 'var(--color-ana-6)' }}>Choose your subdomain:</label>
            <div className="glass-input flex items-center overflow-hidden">
              <input
                type="text"
                value={subdomain}
                onChange={(e) => setSubdomain(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ''))}
                placeholder="your-name"
                className="flex-1 px-4 py-3 bg-transparent font-mono text-lg focus:outline-none"
                style={{ color: 'var(--color-ana-6)' }}
                maxLength={32}
              />
              <span className="pr-4 text-sm" style={{ color: 'var(--color-ana-4)' }}>.{APP_DOMAIN}</span>
            </div>

            {subdomain.length > 0 && (
              <div className="text-sm font-medium">
                {checking && <span style={{ color: 'var(--color-ana-4)' }}>Checking availability...</span>}
                {!checking && available === true && isValid && (
                  <span style={{ color: 'var(--color-ana-5)' }}> {subdomain}.{APP_DOMAIN} is available!</span>
                )}
                {!checking && available === false && (
                  <span className="text-red-400"> Already taken - try another name</span>
                )}
                {!isValid && subdomain.length > 0 && (
                  <span className="text-amber-400">Use lowercase letters, numbers, and dashes (min 3 chars)</span>
                )}
              </div>
            )}

            {available && isValid && (
              <button
                onClick={() => onSelect(subdomain)}
                className="btn-primary w-full px-6 py-3.5 cursor-pointer"
              >
                <span>Claim {subdomain}.{APP_DOMAIN}</span>
              </button>
            )}
          </div>
        );
      }

      function PricingCard({ title, price, interval, features, popular, onSelect }) {
        return (
          <div className={`pricing-card relative p-8 glass-panel-strong ${popular ? 'glow-accent' : ''}`}>
            {popular && (
              <div className="popular-badge absolute -top-3 left-1/2 -translate-x-1/2 px-4 py-1.5 text-xs font-bold rounded-full uppercase tracking-wider" style={{ color: 'var(--color-ana-2)' }}>
                Most Popular
              </div>
            )}
            <h3 className="text-xl font-semibold mb-2" style={{ color: 'var(--color-ana-6)' }}>{title}</h3>
            <div className="mb-6">
              <span className="text-display text-5xl" style={{ color: 'var(--color-ana-6)' }}>{price}</span>
              <span style={{ color: 'var(--color-ana-4)' }}>/{interval}</span>
            </div>
            <ul className="mb-8 space-y-3">
              {features.map((feature, i) => (
                <li key={i} className="flex items-start gap-3">
                  <span className="feature-check mt-0.5">
                    <svg className="w-3 h-3" fill="none" stroke="var(--color-ana-2)" strokeWidth="3" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
                    </svg>
                  </span>
                  <span style={{ color: 'var(--color-ana-5)' }}>{feature}</span>
                </li>
              ))}
            </ul>
            <button
              onClick={onSelect}
              className={`w-full px-6 py-3.5 font-semibold rounded-2xl cursor-pointer transition-all ${
                popular
                  ? 'btn-primary'
                  : 'btn-secondary'
              }`}
            >
              {popular ? <span>Get Started</span> : 'Get Started'}
            </button>
          </div>
        );
      }

      function Hero({ onGetStarted }) {
        const [subdomain, setSubdomain] = useState('');

        const handleGetStarted = () => {
          if (subdomain) {
            onGetStarted(subdomain);
          }
        };

        return (
          <section className="max-w-5xl mx-auto px-6 pt-24 pb-32 relative">
            {/* Decorative elements */}
            <div className="absolute top-20 left-10 w-72 h-72 rounded-full opacity-30 blur-3xl" style={{ background: 'var(--color-ana-1)' }} />
            <div className="absolute bottom-10 right-20 w-96 h-96 rounded-full opacity-20 blur-3xl" style={{ background: 'var(--color-ana-4)' }} />

            <div className="relative max-w-3xl">
              <h1 className="text-display text-5xl md:text-6xl lg:text-7xl mb-6" style={{ color: 'var(--color-ana-6)' }}>
                {APP_TAGLINE}
              </h1>
              <p className="text-body text-xl mb-12 max-w-xl" style={{ color: 'var(--color-ana-4)' }}>
                Your own subdomain. Your own cinema. Drop videos, share with anyone, experience the dark.
              </p>

              <div className="flex flex-col sm:flex-row gap-4 max-w-xl">
                <div className="flex-1 glass-input flex items-center overflow-hidden">
                  <input
                    type="text"
                    placeholder="yourname"
                    value={subdomain}
                    onChange={(e) => setSubdomain(e.target.value.toLowerCase().replace(/[^a-z0-9-]/g, ''))}
                    onKeyDown={(e) => e.key === 'Enter' && handleGetStarted()}
                    className="flex-1 px-5 py-4 bg-transparent focus:outline-none text-lg"
                    style={{ color: 'var(--color-ana-6)' }}
                  />
                  <span className="pr-5 text-sm whitespace-nowrap" style={{ color: 'var(--color-ana-4)' }}>.{APP_DOMAIN}</span>
                </div>
                <button
                  onClick={handleGetStarted}
                  disabled={!subdomain}
                  className="btn-primary px-8 py-4 font-semibold cursor-pointer disabled:opacity-40 disabled:cursor-not-allowed"
                >
                  <span>Claim Your Screen</span>
                </button>
              </div>
            </div>
          </section>
        );
      }

      // === Pending Subdomain Storage ===
      const PENDING_SUBDOMAIN_KEY = 'cinema_pending_subdomain';

      function savePendingSubdomain(subdomain) {
        if (subdomain) {
          localStorage.setItem(PENDING_SUBDOMAIN_KEY, subdomain);
        }
      }

      function getPendingSubdomain() {
        return localStorage.getItem(PENDING_SUBDOMAIN_KEY);
      }

      function clearPendingSubdomain() {
        localStorage.removeItem(PENDING_SUBDOMAIN_KEY);
      }

      // === Onboarding Flow (replaces CheckoutFlow) ===
      function OnboardingFlow({ subdomain: preClaimedSubdomain, onBack }) {
        const { user, isLoaded } = useUser();
        const [activating, setActivating] = useState(false);
        const [localSubdomain, setLocalSubdomain] = useState(preClaimedSubdomain || '');

        // Save subdomain to localStorage whenever it changes
        useEffect(() => {
          if (localSubdomain) {
            savePendingSubdomain(localSubdomain);
          }
        }, [localSubdomain]);

        // Auto-activate when user signs in (pending subdomain takes precedence over existing)
        useEffect(() => {
          if (!isLoaded || !user || activating) return;

          const pendingSubdomain = localSubdomain || getPendingSubdomain();
          if (pendingSubdomain) {
            activateSubdomain(pendingSubdomain);
          }
        }, [isLoaded, user]);

        const activateSubdomain = async (subdomain) => {
          if (!user || !subdomain) return;

          setActivating(true);
          try {
            await user.update({
              unsafeMetadata: {
                ...user.unsafeMetadata,
                subdomain: subdomain,
                plan: 'free',
                registeredAt: new Date().toISOString()
              }
            });
            clearPendingSubdomain();
            window.location.href = `https://${subdomain}.${APP_DOMAIN}`;
          } catch (err) {
            console.error('Error activating subdomain:', err);
            setActivating(false);
            alert('Failed to activate. Please try again.');
          }
        };

        if (activating) {
          return (
            <section className="py-20 px-6 max-w-lg mx-auto relative">
              <div className="absolute inset-0 -z-10">
                <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full opacity-30 blur-3xl" style={{ background: 'var(--color-ana-1)' }} />
              </div>
              <div className="glass-panel-strong p-10 text-center">
                <div className="w-16 h-16 mx-auto mb-6 rounded-2xl flex items-center justify-center animate-pulse" style={{ background: 'linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5))' }}>
                  <svg className="w-8 h-8" fill="none" stroke="var(--color-ana-2)" strokeWidth="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3" />
                    <circle cx="12" cy="12" r="9" />
                  </svg>
                </div>
                <h3 className="text-display text-2xl mb-2" style={{ color: 'var(--color-ana-6)' }}>Setting up your studio...</h3>
                <p style={{ color: 'var(--color-ana-4)' }}>Preparing {localSubdomain || getPendingSubdomain()}.{APP_DOMAIN}</p>
              </div>
            </section>
          );
        }

        return (
          <section className="py-20 px-6 max-w-lg mx-auto relative">
            <div className="absolute inset-0 -z-10">
              <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 rounded-full opacity-30 blur-3xl" style={{ background: 'var(--color-ana-1)' }} />
            </div>

            <div className="glass-panel-strong p-8">
              <button onClick={onBack} className="mb-6 font-medium flex items-center gap-2 transition-colors cursor-pointer" style={{ color: 'var(--color-ana-4)' }}>
                <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
                Back
              </button>

              {/* Subdomain display */}
              <div className="mb-6 p-4 glass-panel text-center">
                <p className="text-sm font-medium mb-1" style={{ color: 'var(--color-ana-4)' }}>Your screening room</p>
                <p className="text-xl font-bold" style={{ color: 'var(--color-ana-6)' }}>{localSubdomain}.{APP_DOMAIN}</p>
              </div>

              <div className="mb-6 pb-6 text-center" style={{ borderBottom: '1px solid rgba(255,255,255,0.1)' }}>
                <span className="inline-block px-3 py-1 text-sm font-semibold rounded-full mb-2" style={{ background: 'var(--color-ana-4)', color: 'var(--color-ana-2)' }}>Free Forever</span>
                <p className="text-sm" style={{ color: 'var(--color-ana-4)' }}>Your own subdomain, unlimited video hosting</p>
              </div>

              <SignedOut>
                <p className="mb-4 text-center" style={{ color: 'var(--color-ana-4)' }}>Create an account to get started:</p>
                <div className="space-y-3">
                  <SignUpButton mode="modal">
                    <button className="btn-primary w-full px-6 py-4 font-semibold cursor-pointer">
                      <span>Create Free Account</span>
                    </button>
                  </SignUpButton>
                  <SignInButton mode="modal">
                    <button className="btn-secondary w-full px-6 py-3 cursor-pointer">
                      Already have an account? Sign In
                    </button>
                  </SignInButton>
                </div>
              </SignedOut>

              <SignedIn>
                <button
                  onClick={() => activateSubdomain(localSubdomain)}
                  disabled={activating || !localSubdomain}
                  className="btn-primary w-full px-6 py-4 font-semibold cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <span>Enter Your Studio</span>
                </button>
              </SignedIn>
            </div>
          </section>
        );
      }

      function LandingPageContent() {
        const { user, isLoaded } = useUser();
        const [showOnboarding, setShowOnboarding] = useState(false);
        const [claimedSubdomain, setClaimedSubdomain] = useState(null);
        const [redirecting, setRedirecting] = useState(false);

        // Check for pending subdomain on load (pending takes precedence over existing)
        useEffect(() => {
          if (!isLoaded) return;

          // If there's a pending subdomain, show onboarding (even if user has existing subdomain)
          const pending = getPendingSubdomain();
          if (user && pending) {
            setClaimedSubdomain(pending);
            setShowOnboarding(true);
          }
        }, [isLoaded, user]);

        const handleGetStarted = (subdomain) => {
          savePendingSubdomain(subdomain);
          setClaimedSubdomain(subdomain);
          setShowOnboarding(true);
        };

        const handleGoToStudio = () => {
          if (user?.unsafeMetadata?.subdomain) {
            setRedirecting(true);
            window.location.href = `https://${user.unsafeMetadata.subdomain}.${APP_DOMAIN}`;
          }
        };

        // Show redirecting state
        if (redirecting) {
          return (
            <div className="min-h-screen flex items-center justify-center gradient-mesh cinema-grid">
              <div className="text-center">
                <div className="animate-pulse text-lg font-semibold" style={{ color: 'var(--color-ana-5)' }}>
                  Taking you to your studio...
                </div>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen gradient-mesh cinema-grid noise-overlay">
              {/* Header */}
              <header className="relative z-10 flex justify-between items-center px-6 py-5 max-w-6xl mx-auto">
                <div className="flex items-center gap-3">
                  {/* Film reel icon */}
                  <div className="w-10 h-10 rounded-xl flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--color-ana-4), var(--color-ana-5))' }}>
                    <svg className="w-5 h-5" fill="none" stroke="var(--color-ana-2)" strokeWidth="2" viewBox="0 0 24 24">
                      <circle cx="12" cy="12" r="3" />
                      <circle cx="12" cy="12" r="9" />
                      <circle cx="12" cy="5" r="1" fill="var(--color-ana-2)" />
                      <circle cx="12" cy="19" r="1" fill="var(--color-ana-2)" />
                      <circle cx="5" cy="12" r="1" fill="var(--color-ana-2)" />
                      <circle cx="19" cy="12" r="1" fill="var(--color-ana-2)" />
                    </svg>
                  </div>
                  <span className="font-bold text-lg tracking-tight" style={{ color: 'var(--color-ana-6)' }}>
                    cinema.computer
                  </span>
                </div>
                <nav>
                  <SignedOut>
                    <div className="flex gap-3 items-center">
                      <SignInButton mode="modal">
                        <button className="px-4 py-2 font-medium transition-colors cursor-pointer" style={{ color: 'var(--color-ana-4)' }}>Sign In</button>
                      </SignInButton>
                      <SignUpButton mode="modal">
                        <button className="btn-primary px-5 py-2.5 font-medium cursor-pointer">
                          <span>Get Started</span>
                        </button>
                      </SignUpButton>
                    </div>
                  </SignedOut>
                  <SignedIn>
                    <div className="flex gap-3 items-center">
                      {user?.unsafeMetadata?.subdomain && (
                        <button
                          onClick={handleGoToStudio}
                          className="btn-primary px-4 py-2 font-medium cursor-pointer"
                        >
                          <span>My Studio</span>
                        </button>
                      )}
                      <UserButton />
                    </div>
                  </SignedIn>
                </nav>
              </header>

              {!showOnboarding ? (
                <>
                  {/* Welcome back banner for existing users */}
                  {user?.unsafeMetadata?.subdomain && (
                    <div className="relative z-10 max-w-2xl mx-auto px-6 pt-12">
                      <div className="glass-panel-strong p-6 text-center glow-accent flex flex-col sm:flex-row items-center justify-between gap-4">
                        <div className="text-left">
                          <h2 className="text-display text-xl mb-1" style={{ color: 'var(--color-ana-6)' }}>Welcome back!</h2>
                          <p style={{ color: 'var(--color-ana-4)' }}>
                            <span className="font-bold" style={{ color: 'var(--color-ana-5)' }}>{user.unsafeMetadata.subdomain}.{APP_DOMAIN}</span> is ready
                          </p>
                        </div>
                        <button
                          onClick={handleGoToStudio}
                          className="btn-primary px-6 py-3 font-semibold cursor-pointer whitespace-nowrap"
                        >
                          <span>Enter Your Studio</span>
                        </button>
                      </div>
                    </div>
                  )}

                  <Hero onGetStarted={handleGetStarted} />

                  {/* Features Grid */}
                  <section className="relative z-10 py-24 px-6 max-w-5xl mx-auto">
                    <div className="text-center mb-12">
                      <h2 className="text-display text-3xl mb-4" style={{ color: 'var(--color-ana-6)' }}>Free Forever</h2>
                      <p style={{ color: 'var(--color-ana-4)' }}>Everything you need for your personal screening room.</p>
                    </div>
                    <div className="grid md:grid-cols-3 gap-6">
                      {[
                        { icon: '', title: 'Your Own Subdomain', desc: 'yourname.cinema.computer  memorable and permanent.' },
                        { icon: '', title: 'Unlimited Hosting', desc: 'Drop any video. We handle the rest.' },
                        { icon: '', title: 'Dark Cinema Mode', desc: 'Immersive viewing, no distractions.' }
                      ].map((feature, i) => (
                        <div key={i} className="glass-panel p-6 text-center">
                          <div className="text-3xl mb-4">{feature.icon}</div>
                          <h3 className="font-semibold text-lg mb-2" style={{ color: 'var(--color-ana-6)' }}>{feature.title}</h3>
                          <p className="text-sm" style={{ color: 'var(--color-ana-4)' }}>{feature.desc}</p>
                        </div>
                      ))}
                    </div>
                  </section>
                </>
              ) : (
                <OnboardingFlow subdomain={claimedSubdomain} onBack={() => { setShowOnboarding(false); clearPendingSubdomain(); }} />
              )}

              {/* Footer */}
              <footer className="relative z-10 py-10 px-6 text-center" style={{ borderTop: '1px solid rgba(255,255,255,0.05)' }}>
                <p className="text-sm" style={{ color: 'var(--color-ana-4)' }}>
                  Built with <a href="https://vibes.diy" className="hover:underline transition-colors" style={{ color: 'var(--color-ana-5)' }}>Vibes DIY</a>
                </p>
              </footer>
            </div>
        );
      }

      function LandingPage() {
        return (
          <ClerkProvider publishableKey={CLERK_PUBLISHABLE_KEY} afterSignOutUrl="/">
            <LandingPageContent />
          </ClerkProvider>
        );
      }

      // === Main Router ===
      function AppRouter() {
        if (routeInfo.route === 'admin') {
          return <AdminApp />;
        }
        if (routeInfo.route === 'tenant') {
          return <TenantApp subdomain={routeInfo.subdomain} />;
        }
        return <LandingPage />;
      }

      // Render
      const rootElement = document.getElementById("container");
      ReactDOMClient.createRoot(rootElement).render(<AppRouter />);
    </script>
  </body>
</html>
